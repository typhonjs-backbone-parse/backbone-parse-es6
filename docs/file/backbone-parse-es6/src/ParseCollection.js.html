<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">backbone-parse-es6/src/ParseCollection.js | backbone-parse-es6 API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/typhonjs/backbone-parse-es6/" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/src/ParseCollection.js~ParseCollection.html">ParseCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/src/ParseModel.js~ParseModel.html">ParseModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-modelExtend">modelExtend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseExtend">parseExtend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseSync">parseSync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parseCollection">parseCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parseModel">parseModel</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">backbone-es6/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Backbone.js~Backbone.html">Backbone</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Collection.js~Collection.html">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Debug.js~Debug.html">Debug</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Events.js~Events.html">Events</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/History.js~History.html">History</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/Utils.js~Utils.html">Utils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/backbone-es6@master/src/View.js~View.html">View</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extend">extend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sync">sync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BackboneProxy">BackboneProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-collection">collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-model">model</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">(typhonjs-core-backbone-common):<br>typhonjs-backbone-common/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/typhonjs-core-backbone-common@master/src/TyphonEvents.js~TyphonEvents.html">TyphonEvents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typhonExtend">typhonExtend</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">(typhonjs-core-backbone-query):<br>backbone-query/src</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/backbone-parse-es6/jspm_packages/github/typhonjs/typhonjs-core-backbone-query@master/src/BackboneQuery.js~BackboneQuery.html">BackboneQuery</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">backbone-parse-es6/src/ParseCollection.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import _                from &apos;underscore&apos;;
import Model            from &apos;./ParseModel.js&apos;;
import Collection       from &apos;backbone-es6/src/Collection.js&apos;;

import BackboneQuery    from &apos;backbone-query&apos;;

import Debug            from &apos;backbone-es6/src/Debug.js&apos;;

/**
 * ParseCollection - Collections are ordered sets of models. (http://backbonejs.org/#Collection)
 * -------------------
 *
 * This implementation of Backbone.Collection provides a `parse` method which coverts the response of a Parse.Query
 * to ParseModels. One must set a Parse.Query instance as options.query or use a getter method such as &quot;get query()&quot;.
 *
 * Please see the `Collection` documentation for relevant information about the parent class / implementation.
 *
 * In addition ParseCollection includes BackboneQuery support which supports local query / sorting of collections.
 * Additional methods: `find, findOne, resetQueryCache, sortAll, whereBy`.
 *
 * @example
 *
 * If using Backbone-ES6 by ES6 source one can create a module for a Backbone.Collection:
 * import Backbone   from &apos;backbone&apos;;
 * import Parse      from &apos;parse&apos;;
 *
 * export default new Backbone.Collection(null,
 * {
 *    model: Backbone.Model.extend(...),
 *    query: new Parse.Query(&apos;&lt;TABLE_NAME&gt;&apos;)
 * });
 *
 * or if importing a specific model class
 *
 * import Backbone   from &apos;backbone&apos;;
 * import Parse      from &apos;parse&apos;;
 * import Model      from &apos;&lt;MY-BACKBONE-MODEL&gt;&apos;
 *
 * export default new Backbone.Collection(null,
 * {
 *    model: Model,
 *    query: new Parse.Query(&apos;&lt;TABLE_NAME&gt;&apos;)
 * });
 *
 * or use full ES6 style by using a getter for &quot;model&quot;:
 *
 * import Backbone   from &apos;backbone&apos;;
 * import Parse      from &apos;parse&apos;;
 * import Model      from &apos;&lt;MY-BACKBONE-MODEL&gt;&apos;
 *
 * const s_QUERY = new Parse.Query(&apos;&lt;TABLE_NAME&gt;&apos;);
 *
 * class MyCollection extends Backbone.Collection
 * {
 *    get model() { return Model; }
 *    get query() { return s_QUERY; }
 * }
 *
 * export default new MyCollection();   // If desired drop &quot;new&quot; to export the class itself and not an instance.
 */
class ParseCollection extends Collection
{
   /**
    * When creating a Collection, you may choose to pass in the initial array of models. The collection&apos;s comparator
    * may be included as an option. Passing false as the comparator option will prevent sorting. If you define an
    * initialize function, it will be invoked when the collection is created. There are a couple of options that, if
    * provided, are attached to the collection directly: model, comparator and query.
    *
    * Pass null for models to create an empty Collection with options.
    *
    * @see http://backbonejs.org/#Collection-constructor
    *
    * @param {Array&lt;Model&gt;}   models   - An optional array of models to set.
    * @param {object}         options  - Optional parameters
    */
   constructor(models = [], options = {})
   {
      super(models, _.extend({ abortCtor: true }, options));

      // Allows child classes to abort constructor execution.
      if (_.isBoolean(options.abortCtor) &amp;&amp; options.abortCtor) { return; }

      // Must detect if there are any getters defined in order to skip setting these values directly.
      const hasComparatorGetter = !_.isUndefined(this.comparator);
      const hasModelGetter = !_.isUndefined(this.model);
      const hasQueryGetter = !_.isUndefined(this.query);

      if (options.comparator !== void 0 &amp;&amp; !hasComparatorGetter)
      {
         /**
          * A comparator string indicating the attribute to sort.
          * @type {string}
          */
         this.comparator = options.comparator;
      }

      // The default model for a collection is just a **Backbone.Model**. This should be overridden in most cases.
      if (!hasModelGetter)
      {
         /**
          * The default Backbone.Model class to use as a prototype for this collection.
          * @type {Model}
          */
         this.model = Model;
      }

      if (options.model &amp;&amp; !hasModelGetter)
      {
         if (!(options.model instanceof Model))
         {
            throw new TypeError(&apos;options.model is not an instance of ParseModel.&apos;);
         }

         this.model = options.model;
      }

      if (options.query &amp;&amp; !hasQueryGetter)
      {
         /**
          * A Parse.Query instance
          * @type {Parse.Query}
          */
         this.query = options.query;
      }

      // Allows child classes to postpone initialization.
      if (_.isBoolean(options.abortCtorInit) &amp;&amp; options.abortCtorInit) { return; }

      this._reset();

      this.initialize(...arguments);

      if (models) { this.reset(models, _.extend({ silent: true }, options)); }
   }

   /**
    * Returns a new instance of the collection with an identical list of models.
    *
    * @see http://backbonejs.org/#Collection-clone
    *
    * @returns {Collection} Returns a new collection with shared models.
    */
   clone()
   {
      return new this.constructor(this.models, {
         comparator: this.comparator,
         model: this.model,
         query: this.query
      });
   }

   /**
    * Delegates to `BackboneQuery.find` to return an array of models that match the sort query.
    *
    * @param {string}   query    - A query string.
    * @param {Object}   options  - Optional parameters
    * @returns {Array&lt;Model&gt;}
    */
   find(query, options)
   {
      return BackboneQuery.find(this, query, options);
   }

   /**
    * Delegates to `BackboneQuery.findOne` to return the first model that matches the sort query.
    *
    * @param {string}   query    - A query string.
    * @returns {Model}
    */
   findOne(query)
   {
      return BackboneQuery.findOne(this, query);
   }

   /* eslint-disable no-unused-vars */
   /**
    * `parse` is called by Backbone whenever a collection&apos;s models are returned by the server, in fetch. The function is
    * passed the raw response object, and should return the array of model attributes to be added to the collection.
    * This implementation depends on `parseSync` which utilizes the Parse.Query attached to this collection to return
    * a response of Parse.Object(s) which are then parsed into ParseModels.
    *
    * @param {object}   resp - An array of Parse.Object(s).
    * @param {object}   options - Unused optional parameters.
    * @returns {object|Array[]} An array or single ParseModel(s).
    */
   parse(resp, options)
   {
      /* eslint-enable no-unused-vars */

      let output;

Debug.log(`ParseCollection - parse - 0`, true);

      if (!_.isArray(resp))
      {
         const parseObject = resp;
         output = new this.model({}, { parseObject, updateParseObject: false });

Debug.log(`ParseCollection - parse - 1 - toJSON: ${JSON.stringify(parseObject.toJSON())}`);
      }
      else
      {
         output = [];

Debug.log(`ParseCollection - parse - 2 - resp.length: ${resp.length}`);

         _.each(resp, (parseObject) =&gt;
         {
            const model = new this.model({}, { parseObject, updateParseObject: false });
            output.push(model);

Debug.log(`ParseCollection - parse - 3 - parseObject: ${JSON.stringify(model.toJSON())}`);
         });
      }

      return output;
   }

   /**
    * Delegates to `BackboneQuery.resetQueryCache` to reset this collections query cache.
    */
   resetQueryCache()
   {
      BackboneQuery.resetQueryCache(this);
   }

   /**
    * Delegates to `BackboneQuery.sortAll` to return all models that match the sort query.
    *
    * @param {string}   query    - A query string.
    * @returns {Array&lt;Model&gt;}
    */
   sortAll(query)
   {
      return BackboneQuery.sortAll(this, query);
   }

   /**
    * Delegates to `BackboneQuery.whereBy` to return a new collection with the models that match the sort query.
    *
    * @param {string}   query    - A query string.
    * @param {Object}   options  - Optional parameters
    * @returns {Collection}
    */
   whereBy(query, options)
   {
      return BackboneQuery.whereBy(this, query, options,
      {
         model: this.model,
         query: this.query,
         comparator: this.comparator
      });
   }
}

/**
 * Exports the ParseCollection class.
 */
export default ParseCollection;</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
