<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/sync.js | Backbone-Parse-ES6 API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/typhonrt/backbone-parse-es6/" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ParseCollection.js~ParseCollection.html">ParseCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ParseModel.js~ParseModel.html">ParseModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-modelExtend">modelExtend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseExtend">parseExtend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sync">sync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parseCollection">parseCollection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parseModel">parseModel</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/sync.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import _             from &apos;underscore&apos;;
import BackboneProxy from &apos;backbone-es6/src/BackboneProxy.js&apos;;

import Debug         from &apos;backbone-es6/src/Debug.js&apos;;

/**
 * Syncs a Backbone.Collection via an associated Parse.Query.
 *
 * @param {string}      method      - A string that defines the synchronization action to perform.
 * @param {Collection}  collection  - The model or collection instance to synchronize.
 * @param {object}      options     - Optional parameters
 * @returns {*|ParsePromise}
 */
const syncCollection = (method, collection, options) =&gt;
{
Debug.log(`sync - syncCollection - 0 - method: ${method}; collection.query: ${collection.query.toJSON()}`, true);

   switch(method)
   {
      case &apos;create&apos;:
      case &apos;delete&apos;:
      case &apos;patch&apos;:
      case &apos;update&apos;:
         throw new Error(`syncCollection - unsupported method: ${method}`);

      case &apos;read&apos;:
Debug.log(`sync - sync(Collection) -- read`);

         if (_.isUndefined(collection.query) || collection.query === null)
         {
            throw new Error(&apos;syncCollection - collection.query is undefined or null.&apos;);
         }

         return collection.query.find(options);
   }
};

/**
 * Syncs a Backbone.Model via the associated Parse.Object.
 *
 * @param {string}   method   - A string that defines the synchronization action to perform.
 * @param {Model}    model    - The model instance to synchronize.
 * @param {object}   options  - Optional parameters
 * @returns {*|ParsePromise}
 */
const syncModel = (method, model, options) =&gt;
{
Debug.log(`sync - syncModel - 0 - method: ${method}`, true);

   if (_.isUndefined(model.parseObject) || model.parseObject === null)
   {
      throw new Error(&apos;syncModel - model.parseObject is undefined or null.&apos;);
   }

   switch(method)
   {
      case &apos;create&apos;:
         return model.parseObject.save(null, options);

      case &apos;delete&apos;:
         return model.parseObject.destroy(options);

      case &apos;patch&apos;:
         return model.parseObject.save(null, options);

      case &apos;read&apos;:
         return model.parseObject.fetch(options);

      case &apos;update&apos;:
         return model.parseObject.save(null, options);
   }
};

/**
 * Backbone.sync
 * -------------
 *
 * Override this function to change the manner in which Backbone persists models to the server. This version of
 * sync uses Parse 1.6+ and Parse.Object for Backbone.Model or Parse.Query for Backbone.Collections. You will be
 * passed back a ParsePromise and can use it in a similar manner as one would with Parse itself.
 *
 * Dispatches to Model or Collection sync methods.
 *
 * @param {string}            method   - A string that defines the synchronization action to perform.
 * @param {Model|Collection}  model    - The model or collection instance to synchronize.
 * @param {object}            options  - Optional parameters.
 * @returns {*|ParsePromise}
 */
export default function sync(method, model, options)
{
   if (model instanceof BackboneProxy.backbone.Model)
   {
      return syncModel(method, model, options);
   }
   else if (model instanceof BackboneProxy.backbone.Collection)
   {
      return syncCollection(method, model, options);
   }
   else
   {
      throw new TypeError(&apos;sync - unknown model type.&apos;);
   }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.0)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
